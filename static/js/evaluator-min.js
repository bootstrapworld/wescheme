var Evaluator=function(){var d=function(a){var c=this;this.write=a.write?a.write:function(a){};this.compilationServletUrl=a.compilationServletUrl?a.compilationServletUrl:"/servlets/standalone.ss";this.transformDom=a.transformDom?a.transformDom:function(a){if(helpers.isLocationDom(a)){var b=a;a=document.createElement("span");b=b.children;for(var c,f,d,h=0;h<b.length;h++)"location-id"===b[h].className&&(d=b[h].textContent),"location-line"===b[h].className&&(c=b[h].textContent),"location-column"===b[h].className&&
(f=b[h].textContent);a.appendChild(document.createElement("br"));a.appendChild(document.createTextNode("at line: "+c+", column: "+f+", in "+d))}return a};this.aState=new state.State;this.aState.setPrintHook(function(a){a=types.toDomNode(a);a=c.transformDom(a);c.write(a);helpers.maybeCallAfterAttach(a)});this.aState.setDisplayHook(function(a){var b=document.createElement("span");b.style.whiteSpace="pre-wrap";b.style.fontFamily="monospace";a=a.split("\n").filter(function(a){return""!==a});0<a.length&&
b.appendChild(document.createTextNode(a[0]));var g;for(g=1;g<a.length;g++)newline=document.createElement("br"),newline.style.clear="left",newline.className="value-seperator",b.appendChild(newline),b.appendChild(document.createTextNode(a[g]));b=c.transformDom(b);c.write(b);helpers.maybeCallAfterAttach(b)});this.aState.setToplevelNodeHook(function(){return c.makeToplevelNode()});this.aState.hooks.dynamicModuleLoader=function(a,e,g){c.dynamicModuleLoader(a,e,g)};this.dynamicModuleLoader=function(a,e,
g){m(c.rootLibraryPath+"/"+a+".js?__gensym="+encodeURIComponent(""+Math.random()),e,g)};this.rootLibraryPath="/collects"};d.prototype.setImageProxy=function(a){this.aState.setImageProxyHook(a)};d.prototype.setRootLibraryPath=function(a){this.rootLibraryPath=a};d.prototype.setDynamicModuleLoader=function(a){this.dynamicModuleLoader=a};d.prototype.makeToplevelNode=function(){var a=document.createElement("div"),c=document.createElement("div");c.appendChild(a);this.write(c);helpers.maybeCallAfterAttach(c);
return a};d.prototype.requestBreak=function(){this.aState.requestBreak()};d.prototype.executeProgram=function(a,c,b,e){var g=this;this.compileProgram(a,c,function(a){a=JSON.parse(a);g._onCompilationSuccess((0,eval)("("+a.bytecode+")"),b,e)},function(a){g._onCompilationFailure(JSON.parse(a||'""'),e)})};d.prototype.setCompileProgram=function(a){this.compileProgram=a};d.prototype.compileProgram=function(a,c,b,e){var g=this,f=n({name:a,program:c,format:"json","compiler-version":"1"}),d=new XMLHttpRequest;
d.onreadystatechange=function(){4==d.readyState&&(503==d.status?g.compileProgram(a,c,b,e):200===d.status?b(d.responseText):e(d.responseText))};d.open("POST",this.compilationServletUrl,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.send(f)};d.prototype.executeCompiledProgram=function(a,c,b){this.aState.clearForEval();try{interpret.load(a,this.aState)}catch(e){b(e);return}interpret.run(this.aState,c,b)};var p={}.hasOwnProperty,n=function(a){var c=[],b;for(b in a)p.call(a,
b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")};d.prototype.getTraceFromExn=function(a){if(types.isSchemeError(a)){if(a=a.val,types.isExn(a)&&types.exnContMarks(a))return state.getStackTraceFromContinuationMarks(types.exnContMarks(a))}else if(types.isInternalError(a))return state.getStackTraceFromContinuationMarks(a.contMarks);return[]};d.prototype.getMessageFromExn=function(a){return"undefined"===typeof a?"internal undefined error":types.isSchemeError(a)?(a=a.val,
types.isExn(a)?types.exnMessage(a):a+""):types.isInternalError(a)?a.val+"":a.nodeType?a:a.message};d.prototype._onCompilationSuccess=function(a,c,b){this.executeCompiledProgram(a,c,b)};d.prototype._onCompilationFailure=function(a,c){"string"===typeof a?c(Error(a)):"object"===typeof a?c(this._convertErrorValue(a)):c(Error(a))};d.prototype._convertErrorValue=function(a){return a.type&&"exn:fail:read"===a.type?Error(a.message):a.type&&"moby-failure"===a.type?new q(this._convertDomSexpr(a["dom-message"]),
a["structured-error"]):Error(a+"")};var k=function(a){return types.vector([a.id,parseInt(a.offset),parseInt(a.line),parseInt(a.column),parseInt(a.span)])},l=function(a){var c=[],b;for(b=0;b<a.length;b++)c.push(k(a[b]));return c};l=function(a){var c=[],b;for(b=0;b<a.length;b++)c.push(k(a[b]));return c};var q=function(a,c){this.message=a.textContent||a.innerText||a;this.domMessage=a;if(c){this.structuredError=JSON.parse(c);a=this.structuredError.message;c=[];var b;for(b=0;b<a.length;b++)if("string"===
typeof a[b])c.push(a[b]);else if("ColoredPart"===a[b].type)c.push(new types.ColoredPart(a[b].text,k(a[b].loc)));else if("GradientPart"===a[b].type){var e,d=[];for(e=0;e<a[b].parts.length;e++){var f=a[b].parts[e];d.push(new types.ColoredPart(f.text,k(f.loc)))}c.push(new types.GradientPart(d))}else"MultiPart"===a[b].type?c.push(new types.MultiPart(a[b].text,l(a[b].locs),a[b].solid)):c.push(a[b]+"");this.message=(new types.Message(c)).toString()}else this.structuredError=void 0};d.prototype._convertDomSexpr=
function(a){if("number"===typeof a||"string"===typeof a){var c=document.createElement("span");c.appendChild(document.createTextNode(a+""));return c}if("object"===typeof a){c=document.createElement(a[0]);for(var b=a[1],e=0;e<b.length;e++)"style"===b[e][0]?c.style.cssText=b[e][1]:"class"===b[e][0]?c.className=b[e][1]:c[b[e][0]]=b[e][1];a=a.splice(2);for(e=0;e<a.length;e++)c.appendChild(this._convertDomSexpr(a[e]));return this.transformDom(c)}return a};var m=function(a,c,b){var e=arguments.callee;"queue"in
e||(e.queue={});var d=e.queue;if(a in d)c&&(d[a]?d[a].push(c):c());else{d[a]=c?[c]:[];var f=document.createElement("script");f.type="text/javascript";f.onload=f.onreadystatechange=function(){if(!f.readyState||"loaded"==f.readyState||"complete"==f.readyState){f.onreadystatechange=f.onload=null;document.getElementsByTagName("head")[0].removeChild(f);var b=d[a];for(delete d[a];b.length;)b.shift()()}};f.onerror=function(){f.onreadystatechange=f.onload=null;document.getElementsByTagName("head")[0].removeChild(f);
b()};f.src=a;document.getElementsByTagName("head")[0].appendChild(f)}};return d}();
